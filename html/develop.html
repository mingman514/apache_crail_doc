<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Programming against Crail &mdash; Apache Crail incubating 1.0 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="How to release" href="release.html" />
    <link rel="prev" title="Spark" href="spark.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Apache Crail incubating
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
</ul>
<p class="caption"><span class="caption-text">Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">Deploy Crail</a></li>
<li class="toctree-l1"><a class="reference internal" href="source.html">Building from source</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="run.html">Run</a></li>
</ul>
<p class="caption"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="shell.html">Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="iobench.html">iobench</a></li>
<li class="toctree-l1"><a class="reference internal" href="fsck.html">fsck</a></li>
<li class="toctree-l1"><a class="reference internal" href="spark.html">Spark</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Programming against Crail</a></li>
</ul>
<p class="caption"><span class="caption-text">Help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release.html">How to release</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Apache Crail incubating</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Programming against Crail</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/develop.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="programming-against-crail">
<h1>Programming against Crail<a class="headerlink" href="#programming-against-crail" title="Permalink to this headline">Â¶</a></h1>
<p>The best way to program against Crail is to use Maven. Make sure you have the Crail dependency specified in your application pom.xml file
with the latest Crail version (e.g. 1.1-incubating):</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apache.crail<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>crail-client<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>X.Y<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<p>Then, create a Crail client as follows:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">CrailConfiguration</span> <span class="n">conf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CrailConfiguration</span><span class="o">();</span>
<span class="n">CrailStore</span> <span class="n">store</span> <span class="o">=</span> <span class="n">CrailStore</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">conf</span><span class="o">);</span>
</pre></div>
</div>
<p>Make sure the <code class="code docutils literal notranslate"><span class="pre">$CRAIL_HOME/conf</span></code> directory is part of the classpath.</p>
<p>Crail supports different file types. The simplest way to create a file in Crail is as follows:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">CrailFile</span> <span class="n">file</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">filename</span><span class="o">,</span> <span class="n">CrailNodeType</span><span class="o">.</span><span class="na">DATAFILE</span><span class="o">,</span> <span class="n">CrailStorageClass</span><span class="o">.</span><span class="na">DEFAULT</span><span class="o">,</span> <span class="n">CrailLocationClass</span><span class="o">.</span><span class="na">DEFAULT</span><span class="o">).</span><span class="na">get</span><span class="o">().</span><span class="na">syncDir</span><span class="o">();</span>
</pre></div>
</div>
<p>Aside from the actual filename, the <code class="code docutils literal notranslate"><span class="pre">create()</span></code> call takes as input the storage and location classes which are preferences for the storage tier and physical location that this file should be created in. Crail tries to satisfy these preferences later when the file is written. In the example we do not request any particular storage or location affinity.</p>
<p>This <code class="code docutils literal notranslate"><span class="pre">create()</span></code> command is non-blocking, calling <code class="code docutils literal notranslate"><span class="pre">get()</span></code> on the returning future object awaits the completion of the call. At that time, the file has been created, but its directory entry may not be visible. Therefore, the file may not yet show up in a file enumeration of the given parent directory. Calling <code class="code docutils literal notranslate"><span class="pre">syncDir()</span></code> waits to for the directory entry to be completed. Both the <code class="code docutils literal notranslate"><span class="pre">get()</span></code> and the <code class="code docutils literal notranslate"><span class="pre">syncDir()</span></code> operation can be deffered to a later time at which they may become non-blocking operations.</p>
<p>Once the file is created, a file stream can be obtained for writing:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">CrailBufferedOutputStream</span> <span class="n">outstream</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getBufferedOutputStream</span><span class="o">(</span><span class="mi">1024</span><span class="o">);</span>
</pre></div>
</div>
<p>Here, we create a buffered stream so that we can pass heap byte arrays as well. We could also create a non-buffered stream using</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">CrailOutputStream</span> <span class="n">outstream</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getDirectOutputStream</span><span class="o">(</span><span class="mi">1024</span><span class="o">);</span>
</pre></div>
</div>
<p>In both cases, we pass a write hint (1024 in the example) that indicates to Crail how much data we are intending to write. This allows Crail to optimize metadatanode lookups. Crail never prefetches data, but it may fetch the metadata of the very next operation concurrently with the current data operation if the write hint allows to do so.</p>
<p>Once the stream has been obtained, there exist various ways to write a file. The code snippet below shows the use of the asynchronous interface:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">CrailBuffer</span> <span class="n">dataBuf</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="na">allocateBuffer</span><span class="o">();</span>
<span class="n">Future</span><span class="o">&lt;</span><span class="n">DataResult</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="n">outputStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">dataBuf</span><span class="o">);</span>
<span class="o">...</span>
<span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</pre></div>
</div>
<p>Reading files works very similar to writing. There exist various examples in org.apache.crail.tools.CrailBenchmark.</p>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="spark.html" class="btn btn-neutral float-left" title="Spark" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="release.html" class="btn btn-neutral float-right" title="How to release" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, Apache Software Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>